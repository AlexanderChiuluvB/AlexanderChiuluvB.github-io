<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Alex&apos;s personal blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Alex Chiu">
<meta property="og:url" content="http://AlexanderChiuluvB.github.io/index.html">
<meta property="og:site_name" content="Alex Chiu">
<meta property="og:description" content="Alex&apos;s personal blog">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Alex Chiu">
<meta name="twitter:description" content="Alex&apos;s personal blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://AlexanderChiuluvB.github.io/"/>





  <title>Alex Chiu</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Alex Chiu</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-schedule">
          <a href="/schedule/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br />
            
            Schedule
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            Sitemap
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://AlexanderChiuluvB.github.io/2018/09/02/CSAPP-链接器（二）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alex Chiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Alex Chiu">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/02/CSAPP-链接器（二）/" itemprop="url">CSAPP-链接器（二）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-02T21:01:00+08:00">
                2018-09-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="回顾-链接操作的步骤"><a href="#回顾-链接操作的步骤" class="headerlink" title="回顾 链接操作的步骤"></a>回顾 链接操作的步骤</h3><h4 id="1-确定符号的引用关系-（符号解析）"><a href="#1-确定符号的引用关系-（符号解析）" class="headerlink" title="1.确定符号的引用关系 （符号解析）"></a>1.确定符号的引用关系 （符号解析）</h4><h4 id="2-合并-o文件"><a href="#2-合并-o文件" class="headerlink" title="2.合并.o文件"></a>2.合并.o文件</h4><h4 id="3-确定每个符号的地址"><a href="#3-确定每个符号的地址" class="headerlink" title="3.确定每个符号的地址"></a>3.确定每个符号的地址</h4><h4 id="4-在指令中填入新地址-（2-3-4属于重定位）"><a href="#4-在指令中填入新地址-（2-3-4属于重定位）" class="headerlink" title="4.在指令中填入新地址 （2.3.4属于重定位）"></a>4.在指令中填入新地址 （2.3.4属于重定位）</h4><p><br></p>
<h3 id="符号解析（符号绑定）"><a href="#符号解析（符号绑定）" class="headerlink" title="符号解析（符号绑定）"></a>符号解析（符号绑定）</h3><p>说白了就是把每个模块引用的符号与某个目标模块中的定义符号建立关联</p>
<h4 id="程序中有定义和引用的符号"><a href="#程序中有定义和引用的符号" class="headerlink" title="-程序中有定义和引用的符号"></a>-程序中有定义和引用的符号</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">void swap()&#123;&#125; /*定义符号swap*/</span><br><span class="line">swap();   /*引用符号*/</span><br><span class="line">int *xp = &amp;x; /*定义符号xp，引用符号 x*/</span><br></pre></td></tr></table></figure>
<h4 id="编辑器把定义的符号放在一个符号表当中"><a href="#编辑器把定义的符号放在一个符号表当中" class="headerlink" title="-编辑器把定义的符号放在一个符号表当中"></a>-编辑器把定义的符号放在一个符号表当中</h4><p>1.符号表是一个结构数组，在.symtab节中<br><br><br>2.每个表项包含符号名，长度与位置信息</p>
<h4 id="链接器把符号的引用存放在重定位节中（-rel-text与rel-data）"><a href="#链接器把符号的引用存放在重定位节中（-rel-text与rel-data）" class="headerlink" title="-链接器把符号的引用存放在重定位节中（.rel.text与rel.data）"></a>-链接器把符号的引用存放在重定位节中（.rel.text与rel.data）</h4><h4 id="链接器把每个符号的引用都与一个确定的符号定义建立关联"><a href="#链接器把每个符号的引用都与一个确定的符号定义建立关联" class="headerlink" title="-链接器把每个符号的引用都与一个确定的符号定义建立关联"></a>-链接器把每个符号的引用都与一个确定的符号定义建立关联</h4><p><br></p>
<h3 id="重定位"><a href="#重定位" class="headerlink" title="重定位"></a>重定位</h3><p>1.把多个代码段与数据段合并成一个单独的代码段和数据段<br><br><br>2.计算每个定义的符号在虚拟地址空间中的绝对地址<br><br><br>3.把可执行文件中符号引用处的地址修改为重定位后的地址信息<br><br><br>（局部变量temp分配在栈中，不会在过程外被引用，因此不属于符号定义）</p>
<h3 id="链接符号的类型"><a href="#链接符号的类型" class="headerlink" title="链接符号的类型"></a>链接符号的类型</h3><h4 id="1-Global-Symbols-（模块内部定义的全局符号）"><a href="#1-Global-Symbols-（模块内部定义的全局符号）" class="headerlink" title="1.Global Symbols （模块内部定义的全局符号）"></a>1.Global Symbols （模块内部定义的全局符号）</h4><p>eg: 全局变量  指在本模块定义，但是在外部模块可以使用的</p>
<h4 id="2-External-Symbols-（外部定义的外部符号）"><a href="#2-External-Symbols-（外部定义的外部符号）" class="headerlink" title="2.External Symbols （外部定义的外部符号）"></a>2.External Symbols （外部定义的外部符号）</h4><p>eg: 函数原型的函数名，函数中的带extern的变量名  外部模块定义，在本模块可以使用</p>
<h4 id="3-Local-Symbols-（本模块定义并且引用的局部符号）"><a href="#3-Local-Symbols-（本模块定义并且引用的局部符号）" class="headerlink" title="3.Local Symbols （本模块定义并且引用的局部符号）"></a>3.Local Symbols （本模块定义并且引用的局部符号）</h4><p>eg: 带static的变量名  分配在静态数据区，并不是局部变量！局部变量是分配在栈中的<br>本模块定义，只能在本模块使用</p>
<p>类型举例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">int buf[2] = &#123;1,2&#125;;</span><br><span class="line">void swap();</span><br><span class="line"></span><br><span class="line">int main()&#123;</span><br><span class="line">	swap();</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">extern int buf[];</span><br><span class="line"></span><br><span class="line">int*bufp0 = &amp;buf[0];</span><br><span class="line">static int *bufp1;</span><br><span class="line"></span><br><span class="line">void swap()&#123;</span><br><span class="line">   int temp;</span><br><span class="line">   bufp1 = &amp;buf[1];</span><br><span class="line">   temp = *bufp0;</span><br><span class="line">   *bufp0 = *bufp1;</span><br><span class="line">   *bufp1 = temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>全局符号： main.c中的buf,swap.c中的swap（）,bufp0;</p>
<p>外部符号  swap.c中的buf[],main.c中的swap();</p>
<p>局部符号  swap.c中的局部符号</p>
<h4 id="我们说符号的定义，实质上就是分配了存储空间。"><a href="#我们说符号的定义，实质上就是分配了存储空间。" class="headerlink" title="我们说符号的定义，实质上就是分配了存储空间。"></a>我们说符号的定义，实质上就是分配了存储空间。</h4><h4 id="函数名符号指代码所在区"><a href="#函数名符号指代码所在区" class="headerlink" title="函数名符号指代码所在区"></a>函数名符号指代码所在区</h4><h4 id="变量名指静态数据区"><a href="#变量名指静态数据区" class="headerlink" title="变量名指静态数据区"></a>变量名指静态数据区</h4><p>定义符号的值就是目标所在的首地址</p>
<h4 id="全局符号的强，弱"><a href="#全局符号的强，弱" class="headerlink" title="全局符号的强，弱"></a>全局符号的强，弱</h4><p>函数名以及初始化后的变量是强全局符号</p>
<p>未初始化变量是弱全局符号</p>
<p>上面函数 main.c 的swap(),swap.c的 buf[],是弱符号，其余的全局符号都是强符号</p>
<h5 id="多重定义符号的解析规则"><a href="#多重定义符号的解析规则" class="headerlink" title="多重定义符号的解析规则"></a>多重定义符号的解析规则</h5><p>1.强符号不能多次定义</p>
<p>2.一个符号被定义为一次强符号和多次弱符号，则按强定义为准</p>
<p>3.多个弱符号定义，则任选其中一个</p>
<h5 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h5><p><img src="/home/alex/图片/sign.png" alt="image"></p>
<p>FLD1指把1.0放在ST（0）处，ST（0）是x87浮点处理器的一个栈</p>
<p>FSTPL &amp;d  L指double对应的双精度，存放8个字节</p>
<p><img src="/home/alex/图片/sign2.png" alt="image"></p>
<p>相当于d变为浮点数表示之后，把x所在的位置给冲掉了，导致x会被改变</p>
<p>（注意小端方式，意味着位数小的放在地址小的位置）</p>
<p><br></p>
<h3 id="静态连接"><a href="#静态连接" class="headerlink" title="静态连接"></a>静态连接</h3><p>多个可重定位目标模块 + 静态库（标准库,自定义库等）<br>(.o文件) + （.a文件，其中包含多个.o模块）</p>
<h5 id="静态库（-a-archive-files）"><a href="#静态库（-a-archive-files）" class="headerlink" title="静态库（.a archive files）"></a>静态库（.a archive files）</h5><p>1.把所有相关的目标模块（.o）打包为一个单独的库文件(.a)，称为静态库文件，也成为存档文件</p>
<p>2.在构建可执行文件的时候，只需要指定库文件名，连接器会自动到库中寻找那些应用程序用到的目标模块，并且只把用到的模块从库中拷贝出来，链接到可执行文件中。</p>
<p>eg: 在函数中使用printf函数，程序员不需要在文件中包括printf的代码，链接器会自动在静态库查找定义的符号来解析printf符号，及实现直接调用。</p>
<h5 id="静态库的创建"><a href="#静态库的创建" class="headerlink" title="静态库的创建"></a>静态库的创建</h5><p>ar 能把指定的.o文件打包生成静态库文件（.a文件）</p>
<p>eg: ar rs libc.a atoi.o printf.o random.o</p>
<h5 id="自定义库文件"><a href="#自定义库文件" class="headerlink" title="自定义库文件"></a>自定义库文件</h5><p>gcc -c p1.c p2.c<br>ar rcs mylib.a p1.o p2.o </p>
<p>然后如果你写了一个main.c，想要调用静态库中的函数</p>
<p>gcc -c main.c<br>gcc -static -o myproc main.o ./mylib.a</p>
<h4 id="使用静态库的过程"><a href="#使用静态库的过程" class="headerlink" title="使用静态库的过程"></a>使用静态库的过程</h4><p><img src="https://wdxtub.com/images/14613353540958.jpg" alt="image"></p>
<p>-按照命令行给出的顺序扫描.o，.a文件</p>
<p>-扫描期间把当前未解析的引用记录到一个列表U中</p>
<p>-每遇到一个新的.o与.a模块，试图用其来解析UI中的符号</p>
<p>-扫描到最后，如果U不为空，则发生错误</p>
<p><img src="/home/alex/图片/eg1.png" alt="image"></p>
<p>总结出来的技巧： 把静态库都放到后面去</p>
<p><br></p>
<h3 id="共享库"><a href="#共享库" class="headerlink" title="共享库"></a>共享库</h3><p>但如果我们只是想用库中的某一函数，却仍然要把所有内容都链接进去，会造成文件中静态库的大量重复。</p>
<p>动态链接可以在首次载入的时候就执行，由ld-linux.so完成，这样所有的程序可以共享同一个库，而不用进行封装。</p>
<p><img src="https://wdxtub.com/images/14613373029640.jpg" alt="image"></p>
<p><br></p>
<h3 id="重定位-1"><a href="#重定位-1" class="headerlink" title="重定位"></a>重定位</h3><h4 id="第一步-合并相同的节"><a href="#第一步-合并相同的节" class="headerlink" title="第一步 合并相同的节"></a>第一步 合并相同的节</h4><p>把集合E中的所有目标模块相同的节合并成新节</p>
<h4 id="第二步-对集合D中的定义符号进行重定位（确定地址）"><a href="#第二步-对集合D中的定义符号进行重定位（确定地址）" class="headerlink" title="第二步 对集合D中的定义符号进行重定位（确定地址）"></a>第二步 对集合D中的定义符号进行重定位（确定地址）</h4><p>即确定新节中所有定义符号在虚拟地址空间中的地址<br>，为变量确定首地址</p>
<p>例如为函数确定首地址，进而确定每条指令的地址，为变量确定首地址</p>
<p>完成这一步之后，每条指令和每个变量的地址都可以确定</p>
<h4 id="第三步-对引用符号进行重定位"><a href="#第三步-对引用符号进行重定位" class="headerlink" title="第三步 对引用符号进行重定位"></a>第三步 对引用符号进行重定位</h4><p>修改.text和.data节中对每个符号的引用（地址）<br>需要用到.o文件中的.rel_data 和.rel_text中保存的重定位信息</p>
<h3 id="什么是重定位信息？"><a href="#什么是重定位信息？" class="headerlink" title="什么是重定位信息？"></a>什么是重定位信息？</h3><p><img src="/home/alex/图片/rede.png" alt="imaeg"></p>
<p>例如 把add B 这一句翻译为机器代码，add翻译为操作码05 B为一个引用，一开始不知道是什么数值，于是写入一个00000000初始位置，同时生成一个重定位条目，提示后面这个位置的值要被修改。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://AlexanderChiuluvB.github.io/2018/08/31/CSAPP-链接器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alex Chiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Alex Chiu">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/31/CSAPP-链接器/" itemprop="url">CSAPP-链接器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-31T21:08:00+08:00">
                2018-08-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CSAPP/" itemprop="url" rel="index">
                    <span itemprop="name">CSAPP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="静态连接"><a href="#静态连接" class="headerlink" title="静态连接"></a>静态连接</h1><h5 id="构造可执行文件的时候，链接器所完成的任务"><a href="#构造可执行文件的时候，链接器所完成的任务" class="headerlink" title="构造可执行文件的时候，链接器所完成的任务:"></a>构造可执行文件的时候，链接器所完成的任务:</h5><h3 id="1-符号解析"><a href="#1-符号解析" class="headerlink" title="1.符号解析"></a>1.符号解析</h3><pre><code>每个符号对应于一个函数，一个全局变量或者静态变量，符号解析的目的是把每个符号引用正好和一个符号定义关联起来。
</code></pre><h3 id="2-重定位"><a href="#2-重定位" class="headerlink" title="2.重定位"></a>2.重定位</h3><pre><code>把每个符号定义和另一个内存位置关联起来，然后重定位这些节，修改所有对这些符号的引用。
</code></pre><p><br></p>
<h2 id="目标文件有三种形式"><a href="#目标文件有三种形式" class="headerlink" title="目标文件有三种形式"></a>目标文件有三种形式</h2><p><br></p>
<h3 id="1-可重定位目标文件：eg-prog-o"><a href="#1-可重定位目标文件：eg-prog-o" class="headerlink" title="1.可重定位目标文件：eg: prog.o"></a>1.可重定位目标文件：eg: prog.o</h3><p>1.包含二进制代码和数据，编译的时候可以和其他可重定位目标文件合并起来，创建一个可执行目标文件。<br><br><br>2.每个.o文件由对应的.c文件生成<br><br><br>3.每个.o文件代码和数据地址都从0开始<br><img src="https://gss2.bdstatic.com/9fo3dSag_xI4khGkpoWK1HF6hhy/baike/c0%3Dbaike80%2C5%2C5%2C80%2C26/sign=3b90ca10d2a20cf4529df68d17602053/80cb39dbb6fd5266b2047183a918972bd407367d.jpg" alt="image"></p>
<h3 id="2-可执行目标文件：eg-a-out"><a href="#2-可执行目标文件：eg-a-out" class="headerlink" title="2.可执行目标文件：eg: a.out"></a>2.可执行目标文件：eg: a.out</h3><p>1.直接可以复制到内存中执行<br><br><br>2.代码和数据地址为虚拟地址空间中的地址</p>
<h3 id="3-共享目标文件（-so）"><a href="#3-共享目标文件（-so）" class="headerlink" title="3.共享目标文件（*.so）"></a>3.共享目标文件（*.so）</h3><p>3.特殊的可重定位目标文件，能在装入或者运行的时候被装入到内存并且自动被链接</p>
<p><br></p>
<h3 id="符号和符号表"><a href="#符号和符号表" class="headerlink" title="符号和符号表"></a>符号和符号表</h3><p>1.被模块m定义并能够被其他模块引用的全局符号。全局连接器的符号对应于非静态的C函数和全局变量。</p>
<p>2.被其它模块定义而且被模块m引用的全局符号，这些符号叫做外部符号，对应于在其它模块中定义的非静态C函数和全局变量。</p>
<p>3.只能被模块m定义和引用的局部符号，对应于带static的C函数和全局变量。</p>
<p>————————————————————分割线————————————————————————-</p>
<h3 id="Coursera-听课笔记"><a href="#Coursera-听课笔记" class="headerlink" title="Coursera 听课笔记"></a>Coursera 听课笔记</h3><p>hello.c-&gt;预处理（cpp）-&gt;hello.i(ASCII中间文件)-&gt;编译器（cc1）-&gt;汇编语言文件-&gt;（汇编器）-&gt;可重定位目标文件(main.o)-&gt;链接-&gt;可执行目标文件</p>
<h4 id="预处理命令"><a href="#预处理命令" class="headerlink" title="预处理命令"></a>预处理命令</h4><p>gcc -E hello.c -o hello.i</p>
<p>cpp hello.c &gt; hello.i</p>
<h5 id="处理源文件中以-开头的预编译指令，包括："><a href="#处理源文件中以-开头的预编译指令，包括：" class="headerlink" title="处理源文件中以#开头的预编译指令，包括："></a>处理源文件中以#开头的预编译指令，包括：</h5><h5 id="1-删除-define-并且展开所定义的宏"><a href="#1-删除-define-并且展开所定义的宏" class="headerlink" title="1.删除#define 并且展开所定义的宏"></a>1.删除#define 并且展开所定义的宏</h5><h5 id="2-处理所有条件预编译指令"><a href="#2-处理所有条件预编译指令" class="headerlink" title="2.处理所有条件预编译指令"></a>2.处理所有条件预编译指令</h5><h5 id="3-插入头文件到-include-处，可以用递归方式进行处理"><a href="#3-插入头文件到-include-处，可以用递归方式进行处理" class="headerlink" title="3.插入头文件到#include 处，可以用递归方式进行处理"></a>3.插入头文件到#include 处，可以用递归方式进行处理</h5><h5 id="4-删除所有的注释”-“和“-”"><a href="#4-删除所有的注释”-“和“-”" class="headerlink" title="4.删除所有的注释”//“和“/ /”"></a>4.删除所有的注释”//“和“/<em> </em>/”</h5><h5 id="5-保留所有-pragma编译指令"><a href="#5-保留所有-pragma编译指令" class="headerlink" title="5.保留所有#pragma编译指令"></a>5.保留所有#pragma编译指令</h5><h5 id="6-添加行号和文件名标识，方便编译的时候编译器产生调试用的行号信息"><a href="#6-添加行号和文件名标识，方便编译的时候编译器产生调试用的行号信息" class="headerlink" title="6.添加行号和文件名标识，方便编译的时候编译器产生调试用的行号信息"></a>6.添加行号和文件名标识，方便编译的时候编译器产生调试用的行号信息</h5><h4 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h4><p>把预处理文件进行此法分析，语法分析，语义分析并且优化</p>
<h6 id="编译命令"><a href="#编译命令" class="headerlink" title="编译命令"></a>编译命令</h6><p>gcc -S hello.i -o hello.s<br><br><br>gcc -S hello.c -o hello.s<br><br><br>但是得到的.s 汇编代码文件，机器仍然无法识别</p>
<h4 id="汇编"><a href="#汇编" class="headerlink" title="汇编"></a>汇编</h4><p>.s 文件称为汇编语言源程序<br><br><br>汇编程序用来把汇编语言源程序转换为机器指令序列<br><br><br>汇编指令和机器指令一一对应，前者是后者的符号表示，他们都属于机器级指令，所构成程序称为机器级代码<br><br><br>gcc -c hello.s -o hello.o<br><br><br>gcc -c hello.c -o hello.o<br><br><br>汇编结果是一个可重定位的目标文件</p>
<h4 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h4><p>把多个可重定位目标文件合并来生成可执行目标文件命令</p>
<p>gcc -static -o myporc main.o test.o</p>
<h4 id="链接器的由来："><a href="#链接器的由来：" class="headerlink" title="链接器的由来："></a>链接器的由来：</h4><p>用符号表示跳转位置，无需修改jmp指令的跳转目标</p>
<h5 id="汇编语言出现："><a href="#汇编语言出现：" class="headerlink" title="汇编语言出现："></a>汇编语言出现：</h5><p>用助记符表示操作码 jmp mov<br><br><br>   用符号表示位置    L0<br><br><br>   用助记符表示寄存器<br><br><br>   最终进行汇编和链接</p>
<p> 链接，先确定L0的地址，然后在jmp指令中填入L0的地址</p>
<h5 id="高级编程语言的出现"><a href="#高级编程语言的出现" class="headerlink" title="高级编程语言的出现"></a>高级编程语言的出现</h5><p>子程序起始地址和变量初始地址是符号定义<br><br><br>调用子程序和使用变量是符号的引用</p>
<h4 id="链接操作的步骤"><a href="#链接操作的步骤" class="headerlink" title="链接操作的步骤"></a>链接操作的步骤</h4><p>1.确定符号引用关系（符号解析）<br><br><br>2.合并相关.o文件<br><br><br>3.确定每个符号的地址<br><br><br>4.在指令中填入新的地址<br>（2.3.4都属于重定位）</p>
<h4 id="使用链接好处"><a href="#使用链接好处" class="headerlink" title="使用链接好处"></a>使用链接好处</h4><p>模块化<br><br><br>1.一个程序可以分成很多源程序文件<br><br><br>2.可以构建共享函数库<br><br><br>效率高<br><br><br>1.空间上无需包含共享库所有代码<br><br><br>2.源文件当中无需包含共享库所有代码<br>例如只要直接调用printf（）函数，无需包含其源码<br>可执行文件和运行时的内存只需包含所调用函数的代码，不需要包含整个共享库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">main.c</span><br><span class="line">  int buf[2] =&#123;1,2&#125;;</span><br><span class="line">  void swap();</span><br><span class="line">  </span><br><span class="line">  int main()&#123;</span><br><span class="line">  	swap();</span><br><span class="line">    return 0;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">swap.c</span><br><span class="line">extern int buf[];</span><br><span class="line">int *bufp0 = &amp;buf[0];</span><br><span class="line">static int *bufp1;</span><br><span class="line"></span><br><span class="line">void swap()&#123;</span><br><span class="line">	int temp;</span><br><span class="line">    bufp1 = &amp;buf[1];</span><br><span class="line">    temp = *bufp0;</span><br><span class="line">    *bufp0 = *bufp1;</span><br><span class="line">    *bufp1 = temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="局部变量temp-分配在栈中，不会在过程（函数）被引用，因此不是符号定义"><a href="#局部变量temp-分配在栈中，不会在过程（函数）被引用，因此不是符号定义" class="headerlink" title="局部变量temp 分配在栈中，不会在过程（函数）被引用，因此不是符号定义"></a>局部变量temp 分配在栈中，不会在过程（函数）被引用，因此不是符号定义</h6><h6 id="可执行文件生成-O2-2级优化-g-生成调试信息-o-目标文件名"><a href="#可执行文件生成-O2-2级优化-g-生成调试信息-o-目标文件名" class="headerlink" title="可执行文件生成 -O2 2级优化  -g 生成调试信息 -o 目标文件名"></a>可执行文件生成 -O2 2级优化  -g 生成调试信息 -o 目标文件名</h6><h5 id="链接本质：合并相同的节"><a href="#链接本质：合并相同的节" class="headerlink" title="链接本质：合并相同的节"></a>链接本质：合并相同的节</h5><p>系统代码： .text<br><br><br>系统数据： .data<br><br><br>未初始化的静态变量： .bss<br><br><br>未初始化的全局变量 COMMON<br><br><br>链接就是要把不同可重定位目标文件中相同的节合在一起，放在可执行目标文件当中</p>
<p>程序头表</p>
<h4 id="目标文件的格式"><a href="#目标文件的格式" class="headerlink" title="目标文件的格式"></a>目标文件的格式</h4><h5 id="目标代码：编译器和汇编器处理源代码后生成的机器语言目标代码"><a href="#目标代码：编译器和汇编器处理源代码后生成的机器语言目标代码" class="headerlink" title="目标代码：编译器和汇编器处理源代码后生成的机器语言目标代码"></a>目标代码：编译器和汇编器处理源代码后生成的机器语言目标代码</h5><h5 id="目标文件：包含目标代码的文件"><a href="#目标文件：包含目标代码的文件" class="headerlink" title="目标文件：包含目标代码的文件"></a>目标文件：包含目标代码的文件</h5><h5 id="静态连接库文件可以由若干个可重定位目标文件组成"><a href="#静态连接库文件可以由若干个可重定位目标文件组成" class="headerlink" title="静态连接库文件可以由若干个可重定位目标文件组成"></a>静态连接库文件可以由若干个可重定位目标文件组成</h5><h2 id="ELF（Executable-and-Linkable-Format）"><a href="#ELF（Executable-and-Linkable-Format）" class="headerlink" title="ELF（Executable and Linkable Format）"></a>ELF（Executable and Linkable Format）</h2><p>两种视图<br><br><br>1.链接视图<br><br><br>2.执行视图</p>
<p><img src="/home/alex/图片/ELF.png" alt="image"></p>
<p>可执行目标文件  的节（section）是ELF文件中具有相同特征的最小可处理单位，例如 .text：代码,.data节数据,.rodata只读数据,.bss未初始化的数据</p>
<p>可重定位目标文件<br>由不同的段（Segment）组成，描述节如何映射到存储段中，多个节可以映射到同一个段中，例如可以合并<br>.data节和.bss节，映射到一个可读可写的数据段中。</p>
<h4 id="链接视图——可重定位目标文件格式"><a href="#链接视图——可重定位目标文件格式" class="headerlink" title="链接视图——可重定位目标文件格式"></a>链接视图——可重定位目标文件格式</h4><p><img src="/home/alex/图片/Linkable.png" alt="image"></p>
<p><img src="/home/alex/图片/elf2.png" alt="image"><br><br><br>补充： 节头表包含每个节的节名，偏移以及大小。<br><br><br>从ELF头读取节头表，再在节头表中读取节的信息</p>
<h5 id="C语言规定"><a href="#C语言规定" class="headerlink" title="C语言规定"></a>C语言规定</h5><p>未初始化的全局变量和局部静态变量默认初始值为0</p>
<h5 id="把-bss-与-data分开的好处"><a href="#把-bss-与-data分开的好处" class="headerlink" title="把.bss 与 .data分开的好处"></a>把.bss 与 .data分开的好处</h5><p>data节中存放具体的初始值，需要占磁盘空间<br>.bss无需存放初始值，只要说明.bss每个变量将来在执行的时候占用多少字节就行<br>因此.bss实际上不占用磁盘空间，提高了磁盘空间利用率</p>
<p><br><br>所有 未初始化的全局变量和局部静态变量都被汇总到.bss节中，通过专门的“节头表”来说明应该为.bss节预留多大的空间<br><br><br>.bss 最初是UA-SAP汇编程序中所用的一个伪指令，为符号预留一块内存空间。</p>
<p><img src="/home/alex/图片/ELFHEAD.png" alt="image"></p>
<p>ELF头占52个字节<br>Elf_Half 占2个，e_ident 16个， 其他的占4个</p>
<p><img src="/home/alex/图片/elfinfo.png" alt="image"></p>
<p>在链接视图中，虚拟地址都为0，因为其并不会执行</p>
<h4 id="执行视图–可执行目标文件"><a href="#执行视图–可执行目标文件" class="headerlink" title="执行视图–可执行目标文件"></a>执行视图–可执行目标文件</h4><p><img src="/home/alex/图片/EXECUABLE.png" alt="IMGAE"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h3 id="1-可执行目标文件是ELF的执行视图，由不同的段组成"><a href="#1-可执行目标文件是ELF的执行视图，由不同的段组成" class="headerlink" title="1.可执行目标文件是ELF的执行视图，由不同的段组成"></a>1.可执行目标文件是ELF的执行视图，由不同的段组成</h3><h3 id="2-可重定位目标文件是ELF格式的链接视图，由不同的节组成"><a href="#2-可重定位目标文件是ELF格式的链接视图，由不同的节组成" class="headerlink" title="2.可重定位目标文件是ELF格式的链接视图，由不同的节组成"></a>2.可重定位目标文件是ELF格式的链接视图，由不同的节组成</h3><h3 id="3-两种目标文件的数据都是二进制表示的补码形式"><a href="#3-两种目标文件的数据都是二进制表示的补码形式" class="headerlink" title="3.两种目标文件的数据都是二进制表示的补码形式"></a>3.两种目标文件的数据都是二进制表示的补码形式</h3><h3 id="4-链接的本质："><a href="#4-链接的本质：" class="headerlink" title="4. 链接的本质："></a>4. 链接的本质：</h3><p>把指定的若干个可重定位目标模块的代码和数据分别合并，以生成一个只读代码段和一个可读可写数据段</p>
<h3 id="5-链接器主要功能："><a href="#5-链接器主要功能：" class="headerlink" title="5. 链接器主要功能："></a>5. 链接器主要功能：</h3><p>符号解析以及重定位</p>
<h3 id="6-符号解析的含义"><a href="#6-符号解析的含义" class="headerlink" title="6.符号解析的含义"></a>6.符号解析的含义</h3><p>就是对每个需要链接的模块中的符号引用找到对应的符号定义，把符号引用与每一个唯一的符号定义进行绑定。</p>
<h3 id="7-重定位"><a href="#7-重定位" class="headerlink" title="7.重定位"></a>7.重定位</h3><p>把合并后的只读代码段以及可读可写数据段中符号引用处的引用位置重新填上新的数值，用来指向绑定的定义符号。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/header.jpg"
                alt="Alex Chiu" />
            
              <p class="site-author-name" itemprop="name">Alex Chiu</p>
              <p class="site-description motion-element" itemprop="description">Alex's personal blog</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">categories</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Alex Chiu</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
